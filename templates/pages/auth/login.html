{% extends "base/layout.html" %}
{% load static %}

{% block title %}Sign In — InvoiceFlow{% endblock %}

{% block navbar %}{% endblock %}
{% block footer %}{% endblock %}

{% block content %}
<div class="auth-scene" x-data="loginPage()" x-init="init()">

    <!-- Animated Background -->
    <div class="auth-bg">
        <div class="auth-bg-orb auth-bg-orb-1"></div>
        <div class="auth-bg-orb auth-bg-orb-2"></div>
        <div class="auth-bg-orb auth-bg-orb-3"></div>
        <canvas id="auth-grid" class="auth-bg-grid"></canvas>
    </div>

    <!-- Top bar -->
    <header class="auth-topbar">
        <a href="{% url 'invoices:home' %}" class="auth-logo">
            <div class="auth-logo-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                    <line x1="16" y1="13" x2="8" y2="13"/>
                    <line x1="16" y1="17" x2="8" y2="17"/>
                    <polyline points="10 9 9 9 8 9"/>
                </svg>
            </div>
            <span class="auth-logo-text">InvoiceFlow</span>
        </a>
        <div class="flex items-center gap-4">
            <button @click="document.documentElement.classList.toggle('dark')" class="p-2 text-slate-400 hover:text-white transition-colors" title="Toggle dark mode">
                <svg class="w-5 h-5 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                <svg class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 9h-1m15.364-6.364l-.707.707M6.343 17.657l-.707.707m12.728 0l-.707-.707M6.343 6.343l-.707-.707M14.482 12A2.482 2.482 0 1112 9.518 2.482 2.482 0 0114.482 12z"></path></svg>
            </button>
            <a href="{% url 'invoices:signup' %}" class="auth-topbar-link">
                No account? <strong>Sign up free</strong>
            </a>
        </div>
    </header>

    <!-- Main card -->
    <main class="auth-main">
        <!-- Brand/Features Side (Hidden on mobile) -->
        <div class="hidden lg:flex flex-col justify-center max-w-lg mr-20 animate-fade-in">
            <h2 class="text-5xl font-extrabold text-white leading-tight mb-8">
                Invoicing that feels <br>
                <span class="text-indigo-400">effortless.</span>
            </h2>
            <div class="space-y-6">
                <div class="flex items-start gap-4">
                    <div class="w-10 h-10 rounded-xl bg-indigo-500/20 flex items-center justify-center flex-shrink-0 text-indigo-400">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-white">Lightning Fast</h4>
                        <p class="text-slate-400">Create and send professional invoices in under 60 seconds.</p>
                    </div>
                </div>
                <div class="flex items-start gap-4">
                    <div class="w-10 h-10 rounded-xl bg-emerald-500/20 flex items-center justify-center flex-shrink-0 text-emerald-400">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-white">Get Paid Faster</h4>
                        <p class="text-slate-400">Integrated payments and automatic reminders reduce payment delays by 40%.</p>
                    </div>
                </div>
                <div class="flex items-start gap-4">
                    <div class="w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center flex-shrink-0 text-blue-400">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-white">Insightful Reports</h4>
                        <p class="text-slate-400">Real-time analytics to help you understand your business growth.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="auth-card" :class="{ 'auth-card--shake': shaking }">

            <!-- Card header -->
            <div class="auth-card-header">
                <div class="auth-card-badge">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                    Secure Sign In
                </div>
                <h1 class="auth-card-title">Welcome back</h1>
                <p class="auth-card-subtitle">Sign in to your InvoiceFlow account to continue</p>
            </div>

            <!-- Alerts -->
            {% if messages %}
            <div class="auth-alerts">
                {% for message in messages %}
                <div class="auth-alert {% if message.tags == 'error' %}auth-alert--error{% else %}auth-alert--info{% endif %}">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                        {% if message.tags == 'error' %}
                        <circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/>
                        {% else %}
                        <circle cx="12" cy="12" r="10"/><path d="M12 8v4m0 4h.01"/>
                        {% endif %}
                    </svg>
                    <span>{{ message }}</span>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Form -->
            <form method="post" novalidate @submit.prevent="submitForm($el)" class="auth-form">
                {% csrf_token %}

                <!-- Email / Username -->
                <div class="auth-field" :class="{ 'auth-field--error': errors.username_or_email, 'auth-field--focused': focused === 'username_or_email', 'auth-field--filled': fields.username_or_email }">
                    <label class="auth-field-label" for="id_username_or_email">Email or Username</label>
                    <div class="auth-field-wrap">
                        <svg class="auth-field-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                            <polyline points="22,6 12,13 2,6"/>
                        </svg>
                        <input
                            type="text"
                            id="id_username_or_email"
                            name="username_or_email"
                            value="{{ form.username_or_email.value|default:'' }}"
                            class="auth-input"
                            placeholder="you@company.com"
                            autocomplete="username email"
                            required
                            autofocus
                            @focus="focused = 'username_or_email'"
                            @blur="focused = null"
                            @input="fields.username_or_email = $el.value; errors.username_or_email = null"
                        >
                    </div>
                    {% if form.username_or_email.errors %}
                    <p class="auth-field-error" x-cloak>{{ form.username_or_email.errors.0 }}</p>
                    {% endif %}
                    <p class="auth-field-error" x-show="errors.username_or_email" x-text="errors.username_or_email" x-cloak></p>
                </div>

                <!-- Password -->
                <div class="auth-field" :class="{ 'auth-field--error': errors.password, 'auth-field--focused': focused === 'password', 'auth-field--filled': fields.password }">
                    <div class="auth-field-label-row">
                        <label class="auth-field-label" for="id_password">Password</label>
                        <a href="{% url 'invoices:password_reset' %}" class="auth-field-link">Forgot password?</a>
                    </div>
                    <div class="auth-field-wrap">
                        <svg class="auth-field-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                            <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                        </svg>
                        <input
                            :type="showPwd ? 'text' : 'password'"
                            id="id_password"
                            name="password"
                            class="auth-input auth-input--padded-right"
                            placeholder="Enter your password"
                            autocomplete="current-password"
                            required
                            @focus="focused = 'password'"
                            @blur="focused = null"
                            @input="fields.password = $el.value; errors.password = null"
                        >
                        <button type="button" class="auth-field-toggle" @click="showPwd = !showPwd" tabindex="-1" aria-label="Toggle password visibility">
                            <svg x-show="!showPwd" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                            <svg x-show="showPwd" x-cloak viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><path d="M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>
                        </button>
                    </div>
                    {% if form.password.errors %}
                    <p class="auth-field-error">{{ form.password.errors.0 }}</p>
                    {% endif %}
                    <p class="auth-field-error" x-show="errors.password" x-text="errors.password" x-cloak></p>
                </div>

                <!-- Remember me -->
                <div class="auth-remember">
                    <label class="auth-checkbox-label">
                        <input type="checkbox" name="remember_me" class="auth-checkbox">
                        <span class="auth-checkbox-box">
                            <svg viewBox="0 0 12 12" fill="none" width="12" height="12"><polyline points="2,6 5,9 10,3" stroke="white" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        </span>
                        <span class="auth-checkbox-text">Keep me signed in for 30 days</span>
                    </label>
                </div>

                <!-- Submit -->
                <button type="submit" class="auth-btn" :disabled="submitting">
                    <span x-show="!submitting" class="auth-btn-content">
                        Sign In
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" width="18" height="18"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                    </span>
                    <span x-show="submitting" x-cloak class="auth-btn-content">
                        <svg class="auth-spinner" viewBox="0 0 24 24" fill="none" width="18" height="18">
                            <circle cx="12" cy="12" r="10" stroke="rgba(255,255,255,0.3)" stroke-width="3"/>
                            <path d="M12 2a10 10 0 0 1 10 10" stroke="white" stroke-width="3" stroke-linecap="round"/>
                        </svg>
                        Signing you in…
                    </span>
                </button>
            </form>

            <!-- Divider -->
            <div class="auth-divider">
                <span>New to InvoiceFlow?</span>
            </div>

            <a href="{% url 'invoices:signup' %}" class="auth-alt-btn">
                Create a free account
            </a>

            <!-- Trust row -->
            <div class="auth-trust">
                <div class="auth-trust-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                    256-bit SSL
                </div>
                <div class="auth-trust-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                    2FA Protected
                </div>
                <div class="auth-trust-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><polyline points="20 6 9 17 4 12"/></svg>
                    GDPR Compliant
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="auth-footer">
        <span>© {% now "Y" %} InvoiceFlow</span>
        <a href="{% url 'invoices:privacy' %}">Privacy</a>
        <a href="{% url 'invoices:terms' %}">Terms</a>
        <a href="{% url 'invoices:contact' %}">Support</a>
    </footer>
</div>

<style>
/* ── Reset & scene ─────────────────────────────────── */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

.auth-scene {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    background: #0a0e1a;
    position: relative;
    overflow: hidden;
    font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
    color: #e2e8f0;
}

/* ── Animated background ───────────────────────────── */
.auth-bg { position: fixed; inset: 0; pointer-events: none; z-index: 0; }

.auth-bg-orb {
    position: absolute;
    border-radius: 50%;
    filter: blur(80px);
    opacity: 0.35;
    animation: orbFloat 12s ease-in-out infinite;
}
.auth-bg-orb-1 { width: 500px; height: 500px; background: radial-gradient(circle, #6366f1, #4f46e5); top: -150px; left: -100px; animation-delay: 0s; }
.auth-bg-orb-2 { width: 400px; height: 400px; background: radial-gradient(circle, #8b5cf6, #7c3aed); bottom: -100px; right: -80px; animation-delay: -4s; }
.auth-bg-orb-3 { width: 300px; height: 300px; background: radial-gradient(circle, #06b6d4, #0891b2); top: 50%; left: 50%; transform: translate(-50%, -50%); opacity: 0.15; animation-delay: -8s; }

@keyframes orbFloat {
    0%, 100% { transform: translate(0, 0) scale(1); }
    33% { transform: translate(30px, -20px) scale(1.05); }
    66% { transform: translate(-20px, 15px) scale(0.97); }
}

.auth-bg-grid {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    opacity: 0.4;
}

/* ── Top bar ───────────────────────────────────────── */
.auth-topbar {
    position: relative;
    z-index: 10;
    width: 100%;
    max-width: 1200px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 24px 32px;
}

.auth-logo {
    display: flex;
    align-items: center;
    gap: 10px;
    text-decoration: none;
    color: white;
}
.auth-logo-icon {
    width: 38px; height: 38px;
    background: linear-gradient(135deg, #6366f1, #8b5cf6);
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 4px 15px rgba(99,102,241,0.4);
}
.auth-logo-icon svg { width: 20px; height: 20px; color: white; }
.auth-logo-text { font-size: 20px; font-weight: 800; letter-spacing: -0.5px; }

.auth-topbar-link {
    font-size: 14px;
    color: #94a3b8;
    text-decoration: none;
    transition: color 0.2s;
}
.auth-topbar-link:hover { color: #e2e8f0; }
.auth-topbar-link strong { color: #a5b4fc; font-weight: 700; }

/* ── Main / Card ───────────────────────────────────── */
.auth-main {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 16px 16px 32px;
    position: relative;
    z-index: 10;
    width: 100%;
}

.auth-card {
    width: 100%;
    max-width: 440px;
    background: rgba(15, 20, 40, 0.7);
    border: 1px solid rgba(99, 102, 241, 0.2);
    border-radius: 24px;
    padding: 40px 36px;
    box-shadow: 0 25px 60px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,255,255,0.04) inset;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    animation: cardAppear 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

@keyframes cardAppear {
    from { opacity: 0; transform: translateY(24px) scale(0.97); }
    to   { opacity: 1; transform: translateY(0) scale(1); }
}

.auth-card--shake {
    animation: cardShake 0.4s ease-in-out;
}
@keyframes cardShake {
    0%, 100% { transform: translateX(0); }
    20% { transform: translateX(-8px); }
    40% { transform: translateX(8px); }
    60% { transform: translateX(-5px); }
    80% { transform: translateX(5px); }
}

/* ── Card header ───────────────────────────────────── */
.auth-card-header { text-align: center; margin-bottom: 32px; }

.auth-card-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: rgba(99,102,241,0.15);
    border: 1px solid rgba(99,102,241,0.3);
    color: #a5b4fc;
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 0.8px;
    text-transform: uppercase;
    padding: 5px 12px;
    border-radius: 100px;
    margin-bottom: 16px;
}
.auth-card-badge svg { color: #818cf8; }

.auth-card-title {
    font-size: 32px;
    font-weight: 800;
    color: #f1f5f9;
    letter-spacing: -0.8px;
    line-height: 1.1;
    margin-bottom: 8px;
}
.auth-card-subtitle {
    font-size: 14px;
    color: #64748b;
    line-height: 1.5;
}

/* ── Alerts ────────────────────────────────────────── */
.auth-alerts { margin-bottom: 24px; display: flex; flex-direction: column; gap: 8px; }

.auth-alert {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 14px;
    border-radius: 12px;
    font-size: 13px;
    font-weight: 500;
    line-height: 1.4;
    animation: alertSlide 0.3s ease;
}
@keyframes alertSlide { from { opacity:0; transform: translateY(-6px); } to { opacity:1; transform: none; } }

.auth-alert--error { background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.25); color: #fca5a5; }
.auth-alert--error svg { color: #f87171; flex-shrink: 0; }
.auth-alert--info  { background: rgba(99,102,241,0.1); border: 1px solid rgba(99,102,241,0.25); color: #a5b4fc; }
.auth-alert--info svg  { color: #818cf8; flex-shrink: 0; }

/* ── Form ──────────────────────────────────────────── */
.auth-form { display: flex; flex-direction: column; gap: 20px; }

/* ── Field ─────────────────────────────────────────── */
.auth-field { display: flex; flex-direction: column; gap: 6px; }

.auth-field-label {
    font-size: 13px;
    font-weight: 600;
    color: #94a3b8;
    transition: color 0.2s;
}
.auth-field--focused .auth-field-label { color: #a5b4fc; }
.auth-field--error   .auth-field-label { color: #f87171; }

.auth-field-label-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
}
.auth-field-link {
    font-size: 12px;
    font-weight: 600;
    color: #818cf8;
    text-decoration: none;
    transition: color 0.2s;
}
.auth-field-link:hover { color: #a5b4fc; }

.auth-field-wrap {
    position: relative;
    display: flex;
    align-items: center;
}

.auth-field-icon {
    position: absolute;
    left: 14px;
    color: #475569;
    pointer-events: none;
    transition: color 0.2s;
    flex-shrink: 0;
}
.auth-field--focused .auth-field-icon { color: #818cf8; }
.auth-field--error   .auth-field-icon { color: #f87171; }

.auth-input {
    width: 100%;
    padding: 13px 14px 13px 44px;
    background: rgba(30, 40, 70, 0.6);
    border: 1.5px solid rgba(71, 85, 105, 0.4);
    border-radius: 12px;
    font-size: 14px;
    color: #f1f5f9;
    outline: none;
    transition: border-color 0.2s, background 0.2s, box-shadow 0.2s;
    -webkit-text-fill-color: #f1f5f9;
}
.auth-input::placeholder { color: #475569; }
.auth-input:focus {
    border-color: #6366f1;
    background: rgba(30, 40, 80, 0.8);
    box-shadow: 0 0 0 3px rgba(99,102,241,0.15);
}
.auth-field--error .auth-input {
    border-color: rgba(239,68,68,0.5);
    box-shadow: 0 0 0 3px rgba(239,68,68,0.1);
}
.auth-input--padded-right { padding-right: 46px; }

.auth-field-toggle {
    position: absolute;
    right: 14px;
    background: none;
    border: none;
    cursor: pointer;
    color: #475569;
    padding: 4px;
    display: flex;
    align-items: center;
    transition: color 0.2s;
}
.auth-field-toggle:hover { color: #94a3b8; }

.auth-field-error {
    font-size: 12px;
    font-weight: 600;
    color: #f87171;
    padding-left: 2px;
    animation: alertSlide 0.25s ease;
}

/* ── Remember ──────────────────────────────────────── */
.auth-remember { display: flex; align-items: center; }

.auth-checkbox-label {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
}
.auth-checkbox { display: none; }
.auth-checkbox-box {
    width: 18px; height: 18px;
    border-radius: 5px;
    border: 1.5px solid rgba(71,85,105,0.6);
    background: rgba(30,40,70,0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    flex-shrink: 0;
}
.auth-checkbox:checked + .auth-checkbox-box {
    background: #6366f1;
    border-color: #6366f1;
    box-shadow: 0 0 0 3px rgba(99,102,241,0.2);
}
.auth-checkbox-box svg { display: none; }
.auth-checkbox:checked + .auth-checkbox-box svg { display: block; }
.auth-checkbox-text { font-size: 13px; color: #64748b; }

/* ── Submit button ─────────────────────────────────── */
.auth-btn {
    width: 100%;
    padding: 15px;
    background: linear-gradient(135deg, #6366f1, #7c3aed);
    border: none;
    border-radius: 12px;
    color: white;
    font-size: 15px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 4px 20px rgba(99,102,241,0.4);
    position: relative;
    overflow: hidden;
    margin-top: 4px;
}
.auth-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(255,255,255,0.1), transparent);
    border-radius: inherit;
}
.auth-btn:hover:not(:disabled) {
    transform: translateY(-1px);
    box-shadow: 0 8px 28px rgba(99,102,241,0.5);
}
.auth-btn:active:not(:disabled) { transform: translateY(0); }
.auth-btn:disabled { opacity: 0.7; cursor: not-allowed; }

.auth-btn-content {
    position: relative;
    z-index: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.auth-spinner {
    animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* ── Divider ───────────────────────────────────────── */
.auth-divider {
    display: flex;
    align-items: center;
    gap: 12px;
    margin: 24px 0 12px;
    font-size: 12px;
    color: #334155;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    font-weight: 600;
}
.auth-divider::before, .auth-divider::after {
    content: '';
    flex: 1;
    height: 1px;
    background: rgba(51,65,85,0.5);
}

/* ── Alt button ────────────────────────────────────── */
.auth-alt-btn {
    display: block;
    width: 100%;
    padding: 13px;
    text-align: center;
    background: rgba(30,40,70,0.5);
    border: 1.5px solid rgba(71,85,105,0.3);
    border-radius: 12px;
    color: #94a3b8;
    font-size: 14px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s;
}
.auth-alt-btn:hover {
    border-color: rgba(99,102,241,0.4);
    background: rgba(99,102,241,0.08);
    color: #a5b4fc;
}

/* ── Trust row ─────────────────────────────────────── */
.auth-trust {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    margin-top: 24px;
    padding-top: 20px;
    border-top: 1px solid rgba(51,65,85,0.3);
}
.auth-trust-item {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 11px;
    font-weight: 600;
    color: #334155;
    letter-spacing: 0.3px;
}
.auth-trust-item svg { color: #475569; }

/* ── Footer ────────────────────────────────────────── */
.auth-footer {
    position: relative;
    z-index: 10;
    padding: 20px 32px;
    display: flex;
    align-items: center;
    gap: 24px;
    font-size: 12px;
    color: #334155;
}
.auth-footer a { color: #334155; text-decoration: none; transition: color 0.2s; }
.auth-footer a:hover { color: #64748b; }

/* ── Responsive ────────────────────────────────────── */
@media (max-width: 480px) {
    .auth-card { padding: 28px 20px; border-radius: 20px; }
    .auth-card-title { font-size: 26px; }
    .auth-topbar { padding: 16px 20px; }
    .auth-trust { gap: 12px; }
    .auth-trust-item span { display: none; }
}
</style>

<script>
function loginPage() {
    return {
        submitting: false,
        shaking: false,
        showPwd: false,
        focused: null,
        fields: { username_or_email: '', password: '' },
        errors: {},

        init() {
            this.drawGrid();
            window.addEventListener('resize', () => this.drawGrid());
        },

        drawGrid() {
            const canvas = document.getElementById('auth-grid');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const step = 48;
            ctx.strokeStyle = 'rgba(99, 102, 241, 0.08)';
            ctx.lineWidth = 0.8;

            for (let x = 0; x <= canvas.width; x += step) {
                ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, canvas.height); ctx.stroke();
            }
            for (let y = 0; y <= canvas.height; y += step) {
                ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(canvas.width, y); ctx.stroke();
            }

            for (let x = 0; x <= canvas.width; x += step) {
                for (let y = 0; y <= canvas.height; y += step) {
                    ctx.beginPath();
                    ctx.arc(x, y, 1.5, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(99, 102, 241, 0.15)';
                    ctx.fill();
                }
            }
        },

        submitForm(form) {
            const un = form.querySelector('[name="username_or_email"]').value.trim();
            const pw = form.querySelector('[name="password"]').value;
            let valid = true;

            if (!un) {
                this.errors.username_or_email = 'This field is required.';
                valid = false;
            }
            if (!pw) {
                this.errors.password = 'This field is required.';
                valid = false;
            }

            if (!valid) {
                this.shaking = true;
                setTimeout(() => this.shaking = false, 500);
                return;
            }

            this.submitting = true;
            form.submit();
        }
    };
}
</script>
{% endblock %}
